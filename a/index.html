<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="shortcut icon" href="/images/favicon.ico" />
	<title>3 3 3 </title>
	<link rel="stylesheet" type="text/css" href="/css/common.css">
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="raphael.js"></script>
	<style>

		#div_page {
			width: 1024px;
			margin: 0 auto;
		}

		#div_title {
			text-align: center;
			font-size: 24px;
			padding: 20px 0px;
		}

		#div_svg {
			width: 1024px;
			height: 1024px;
			margin: 0 auto;
		}

		#div_description {
			text-align: center;
			padding: 20px 0px;
		}

		#button_next {
			background: #ffffff;
			border: #000000 2px solid;
			padding: 5px 10Px;
			font-size: 16px;
			cursor: pointer;
			font-weight: bold;
			color: #000000;
		}

		#button_next:hover {
			background: #000000;
			color: #ffffff;
		}

		#imgCanvas {
			display: none;
		}

		.div_b_class {
			padding: 5px;
			background: #e0e0e0;
			position: absolute;
			font-family: Verdana, sans-serif;
			font-size: 14px;
			display: none;
		}

		.div_b_class a {
			line-height: 25px;
		}

		.div_bText_class {
			float: left;
			margin-left: 5px;
			margin-right: 10px;
			width: 140px;
			height: 80px;
		}

		.div_bPhoto_class {
			float: left;
			width: 80px;
			height: 80px;
			overflow: hidden;
		}

		.round {
			-moz-border-radius: 10px;
			-webkit-border-radius: 10px;
			border-radius: 10px;
			-khtml-border-radius: 10px;
		}

		.spacer {
			clear: both;
		}

	</style>
</head>
<body>
	<div id="div_page">
		<canvas id="imgCanvas" width="1024" height="1024"></canvas>
		<div id="div_title">3 3 3</div>
		<div id="div_svg"></div>
	</div>
<script>
	var color = function( x, y ) {
		/*var r = Math.round( Math.random() * 255 );
		var g = Math.round( Math.random() * 255 );
		var b = Math.round( Math.random() * 255 );
		return "rgb( " + r + " , " + g + " , " + b + " )";*/
		return "#DAA482";
	};

	var svg = function( width, height ) {
		return Raphael( $( "#div_svg" ).position().left,  $( "#div_svg" ).position().top, width, height );
	};

	var s = svg( 1024, 1024 );

	var rect = function( x, y, width, height ) {
		return s.rect( x, y, width, height).attr( { "fill": color( x + width/2, y + height/2 ), "stroke": "none" } );
	};

    var rectOrig = function( x, y, width, height ) {
        return s.image("file2.jpeg", x, y, width, height)
    };

    var nPoints = 0;
    var discretization = 4;

	var Boobs = function( b, blocked ) {
		this.b = b;
		this.blocked = blocked;
		if ( b.attrs.width > discretization ) {
			this.b.hover( function( e ) {
				if ( blocked == 0 ) {
					var e = e || window.event;
					var X = e.layerX;
					var Y = e.layerY;
					var w = b.attrs.width / 2;
					var x = b.attrs.x;
					var y = b.attrs.y;
					var tmp1 = 0;
					var tmp2 = 0;
					var tmp3 = 0;
					var tmp4 = 0;
					if ( ( X >= x ) && ( X <= x + w ) && ( Y >= y ) && ( Y <= y + w ) ) tmp1 = 1;
					if ( ( X >= x + w ) && ( X <= x + 2*w ) && ( Y >= y ) && ( Y <= y + w ) ) tmp2 = 1;
					if ( ( X >= x ) && ( X <= x + w ) && ( Y >= y + w ) && ( Y <= y + 2*w ) ) tmp3 = 1;
					if ( ( X >= x + w ) && ( X <= x + 2*w ) && ( Y >= y + w ) && ( Y <= y + 2*w ) ) tmp4 = 1;
					new Boobs( rectOrig( x, y, w, w ), tmp1 );
					new Boobs( rectOrig( x + w, y, w, w ), tmp2 );
					new Boobs( rectOrig( x, y + w, w, w ), tmp3 );
					new Boobs( rectOrig( x + w, y + w, w, w ), tmp4 );
				}
			}, function() {
				blocked = 0;
			} );
		} else {
			var w = b.attrs.width / 2;
			var x = b.attrs.x;
			var y = b.attrs.y;
			rect(x,y,w,w)
		};
	};

	var draw = function( filename ) {
		s.clear();

		new Boobs( rect( 0, 0, 1024, 1024 ), 0 );

		var ctx = document.getElementById('imgCanvas').getContext('2d');
		var img = new Image();

		img.src = filename;
		img.onload = function() {
			ctx.drawImage( img, 0, 0 );
			color = function( x, y ) {
				var data = ctx.getImageData( x, y, 1, 1 ).data;
				return "rgba( " + data[ 0 ] + " , " + data[ 1 ] + " , " + data[ 2 ] + " , " + data[ 3 ] + " )";
			}
		};
	};

	draw( "file.jpeg");

	$( ".div_b_class" )
		.css( "top", $( window ).height() - $( ".div_b_class" ).height() - 20 )
		.css( "left", 10 );

	var curr_banner = Math.floor( Math.random() * $( ".div_b_class" ).length );
	var banner_period = 3000;
	var banner_duration = 8000;

	var banner = function() {
		var b = $( ".div_b_class" );
		if ( curr_banner > b.length - 1 ) curr_banner = 0;
		b.eq( curr_banner ).delay( banner_period ).fadeIn( 300 ).delay( banner_duration ).fadeOut( 300, function() {
			banner();
		} );
		curr_banner = Math.floor( Math.random() * $( ".div_b_class" ).length );
	};

	banner();

</script>
<!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter20475910 = new Ya.Metrika({id:20475910, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/20475910" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->
</body>
</html>
