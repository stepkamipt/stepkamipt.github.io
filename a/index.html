<head>
	<meta http-equiv="Content-Type" content="text/html;
	<link rel="stylesheet" type="text/css" href="/css/common.css">
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="https://cdnjs.com/libraries/raphael/raphael.js"></script>
	<style>

		#div_page {
			width: 1024px;
			margin: 0 auto;
		}

		#div_svg {
			width: 1024px;
			height: 1024px;
			margin: 0 auto;
		}

		#imgCanvas {
			display: none;
		}

	</style>
</head>
<body>
	<div id="div_page">
		<canvas id="imgCanvas" width="1024" height="1024"></canvas>
		<div id="div_svg"></div>
	</div>

	<script>
		var svg = function( width, height ) {
			return Raphael( $( "#div_svg" ).position().left,  $( "#div_svg" ).position().top, width, height );
		};

		var s = svg( 1024, 1024 );

	    var initialRect = function() {
	        return s.image("http://d2.endata.cx/data/games/25410/logo_small.jpg", 0, 0, 1024, 1024);
	    };

		var rect = function( x, y, width, height ) {
			return s.rect( x, y, width, height).attr( { "fill": color( x + width/2, y + height/2 ), "stroke": "none" } );
		};

	    var rectOrig = function( x, y, width, height ) {
	    	var max = 2;
	    	var min = 0;
		    var player = Math.floor(Math.random() * (max - min + 1)) + min;
		    var filename = "http://d2.endata.cx/data/games/25410/player" + player.toString() + ".jpg";
	        return s.image(filename, x, y, width, height)
	    };

	    var nPoints = 0;
	    var discretization = 16;

		var Boobs = function( b, blocked ) {
			this.b = b;
			this.blocked = blocked;
			if ( b.attrs.width > 1 ) {
				this.b.hover( function( e ) {
					if ( blocked == 0 ) {
						var e = e || window.event;
						var X = e.layerX;
						var Y = e.layerY;
						var w = b.attrs.width / 2;
						var x = b.attrs.x;
						var y = b.attrs.y;
						var tmp1 = 0;
						var tmp2 = 0;
						var tmp3 = 0;
						var tmp4 = 0;
						if ( ( X >= x ) && ( X <= x + w ) && ( Y >= y ) && ( Y <= y + w ) ) tmp1 = 1;
						if ( ( X >= x + w ) && ( X <= x + 2*w ) && ( Y >= y ) && ( Y <= y + w ) ) tmp2 = 1;
						if ( ( X >= x ) && ( X <= x + w ) && ( Y >= y + w ) && ( Y <= y + 2*w ) ) tmp3 = 1;
						if ( ( X >= x + w ) && ( X <= x + 2*w ) && ( Y >= y + w ) && ( Y <= y + 2*w ) ) tmp4 = 1;
						if( w > discretization ) {
							new Boobs( rectOrig( x, y, w, w ), tmp1 );
							new Boobs( rectOrig( x + w, y, w, w ), tmp2 );
							new Boobs( rectOrig( x, y + w, w, w ), tmp3 );
							new Boobs( rectOrig( x + w, y + w, w, w ), tmp4 );
						} else {
							new Boobs( rect( x, y, w, w ), tmp1 );
							new Boobs( rect( x + w, y, w, w ), tmp2 );
							new Boobs( rect( x, y + w, w, w ), tmp3 );
							new Boobs( rect( x + w, y + w, w, w ), tmp4 );
						}
					}
				}, function() {
					blocked = 0;
				} );
			}
		};

		var draw = function( filename ) {
			s.clear();

			new Boobs( initialRect(), 0 );

			var ctx = document.getElementById('imgCanvas').getContext('2d');
			var img = new Image();

			img.src = filename;
			img.onload = function() {
				ctx.drawImage( img, 0, 0 );
				color = function( x, y ) {
					var data = ctx.getImageData( x, y, 1, 1 ).data;
					return "rgba( " + data[ 0 ] + " , " + data[ 1 ] + " , " + data[ 2 ] + " , " + data[ 3 ] + " )";
				}
			};
		};

		draw( "http://d2.endata.cx/data/games/25410/logo_big.jpg");
	</script>
</body>
</html>
